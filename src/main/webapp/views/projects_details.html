<div class="row">
    <div>
        <div class="col-md-2">
            <button class="btn btn-default" ng-click="clear()" translate="general.back">Back</button>
        </div>
        <div class="text-right col-md-10">
            <button type="button" ng-show="showFollow()&&!editable" name="follow_button" class="btn btn-success ng-hide" ng-click="follow()">
                <span class="glyphicon glyphicon-plus"></span>
                <span translate="follow.button" class="ng-scope">Folgen</span>
            </button>
            <button type="button" ng-show="showUnfollow()&&!editable" name="unfollow_button" class="btn btn-danger ng-hide" ng-click="unfollow()">
                <span class="glyphicon glyphicon-minus"></span>
                <span translate="follow.button" class="ng-scope">Folgen</span>
            </button>
            <button class="btn btn-primary" ng-click='edit()' translate='general.edit' ng-show="editable">Edit</button>
        </div>
        <div style="clear:both;"></div>
        <div class="col-xs-12">
            <h2 class="spacer-top" translate="project.details.title" translate-values="{project: '{{project.name}}'}">{{project.name}}</h2>
        </div>
    </div>
    <div class="modal-body">
        <div class="col-md-6">
            <div class="clearfix">
                <uploaded-image name="project.logo.id" class="project-logo pull-left"></uploaded-image>
                <h3 translate="project.details.purpose">Project purpose</h3>
                <div ng-bind-html="purpose"></div>
            </div>
            <div class="tags-container clear-left">
                <h3 translate="project.tags">Tags</h3>
                <tags-input ng-model="project.propertyTags" add-on-space="true" display-property="name" min-length="1" placeholder="{{'project.tags.placeholder' | translate}}">
                    <auto-complete source="getPropertyTagNames($query)" min-length="1"></auto-complete>
                </tags-input>
            </div>
            <div class="rating-container">
                <div class="row">
                    <div id="rating" class="col-md-12">
                        <span>Aktuelle Bewertung: </span>
                        <rating max="5" readonly="!canRate" on-leave="overStar = null"
                                ng-click="showRating()" ng-model="shownRating"></rating>
                    </div>
                    <div class="row" ng-show="ratingSuccess">
                        <div class="col-md-12">
                            <div id="projectRatingSuccess" class="alert alert-success"
                                 translate="rating.success">
                                You have successfully rated!
                            </div>
                        </div>
                    </div>
                </div>
                <div ng-show="isRating">
                    <div class="row">
                        <div class="col-md-12">
                            <hr/>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <textarea ng-model="rating.comment" cols="30" rows="5" placeholder="{{'rating.placeholder' | translate}}"></textarea>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <button class="btn btn-success" ng-click="rateProject()" translate="rating.ratenow">Rate now</button>
                            <button class="btn btn-default" ng-click="hideRating()" translate="rating.notnow">Not now</button>
                        </div>
                    </div>
                    <div class="row" ng-show="projectRatingError">
                        <div class="col-md-12">
                            <div id="projectRatingError" class="alert alert-danger"
                                 translate="rating.error.general">
                                <strong>An error has occured!</strong>
                                Sorry, something went wrong.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="newsfeed">
                <h3>{{ 'postingfeed.title' | translate }}</h3>
                <div class="well">
                    <ul>
                        <li ng-repeat="posting in postings">
                            <h4>{{posting.author.login}} <small>postet: </small><pre>{{posting.information}}</pre><sup><small> {{posting.createdDate | date}}</small></sup><a ng-show="editable" ng-click="deletePosting(posting.id)"><i class="text-right glyphicon glyphicon-remove"></i></a></h4>
                        </li>
                    </ul>
                </div>
                <a ng-click="showMorePostings()" translate="posting.showmore"
                   ng-show="canShowMorePostings()">Show more</a>
                <hr/>
                <form name="postingform" role="form" novalidate class="ng-scope ng-invalid ng-invalid-required ng-dirty ng-valid-minlength" show-validation>
                    <div class="form-group" ng-show="editable">
                        <textarea class="form-control" name="postingInformation" type="text" placeholder="{{'posting.information.placeholder' | translate}}"
                               ng-minlength="5" ng-maxlength="2048" ng-model="postingInformation" required autocomplete="off"/>
                        <button type="submit" class="btn btn-success" ng-disabled="postingform.$invalid" ng-click="addPosting()" translate="general.post">Postbutton</button>
                        <div ng-show="postingform.postingInformation.$dirty && postingform.postingInformation.$invalid">
                            <p class="help-block"
                               ng-show="postingform.postingInformation.$error.minlength" translate="global.messages.validate.posting.minlength">
                                Your Posting is required to be at least 5 characters
                            </p>
                            <p class="help-block"
                               ng-show="postingform.postingInformation.$error.maxlength" translate="global.messages.validate.posting.maxlength">
                                Your Posting is required to be at max 2048 characters
                            </p>
                            <p class="help-block"
                               ng-show="postingform.postingInformation.$error.required" translate="global.messages.validate.posting.required">
                                Your Posting is required
                            </p>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        </div>
        <div class="col-md-6">
            <img src="/images/approved.png" alt="approved" class="approved" ng-show="successful || remainingDays == true" />
            <div class="remaining" ng-show="remainingDays != true && remainingDays > 0 && project.concrete == true">
                <div class="col-md-2 pull-right"><strong>{{project.startDate | date}}</strong></div>
                <strong>{{ 'project.details.estimatedaysuntilstart' | translate:'{days: remainingDays}' }}</strong>
                <progressbar class="progress-striped" value="50"></progressbar>
            </div>
            <div class="resources">
                <strong>{{ 'project.details.resourcecollected' | translate:'{percentage: collected}' }}</strong>
                <progressbar class="progress-striped" value="collected"></progressbar>
                <strong>{{ 'project.details.resourceneeded' | translate:'{essential: collectedEssential}' }}</strong>
                <progressbar class="progress-striped" value="collectedEssential"></progressbar>
            </div>
            <div class="resource-requirements">
                <h2>{{ 'project.details.details' | translate}}</h2>
                <accordion close-others="true">
                    <accordion-group ng-open="requirement.id" ng-repeat="requirement in project.resourceRequirements">
                        <accordion-heading>
                            <div class="row hover-toggle" ng-click="expandResource(requirement, $event)">
                                <div class="col-md-6">{{requirement.name}}</div>
                                <div class="col-md-3 on-hover">
                                    <button class="btn btn-default btn-sm" ng-show="isAllowedToApply()&&(requirement.sum<requirement.originalAmount)" type="button" ng-click="projectApply(requirement, $event)" translate="resource.offer.donate" data-toggle="modal" data-target="#apply">Donate</button>
                                </div>
                                <div class="col-md-3" style="text-align: right;">
                                    <span ng-show="requirement.sum != undefined">{{requirement.sum}}</span>
                                    <span ng-show="requirement.sum == undefined">0</span>/{{requirement.originalAmount}}
                                    <i class="glyphicon" ng-class="{'glyphicon-chevron-down': requirement.expanded, 'glyphicon-chevron-right': !requirement.expanded}"></i>
                                </div>
                            </div>
                        </accordion-heading>
                        <ul>
                            <li ng-repeat="match in requirement.matches">
                                <img src="images/profile_empty.png" alt="profile-picture" class="pull-left">
                                <div class="col-md-4 strong">{{match.organization.name}}</div>
                                <div class="col-md-4 pull-right">{{match.amount}}/{{requirement.originalAmount}}</div>
                                <div class="col-md-4">
                                    <rating max="5" on-leave="overStar = null"
                                            readonly="!matchRatingPermissions[match.matchId]"
                                            ng-click="rateMatch(match.matchId)"
                                            ng-model="organizationRatings[match.organization.id].rating"></rating>
                                </div>
                            </li>
                        </ul>
                    </accordion-group>

                </accordion>
            </div>

            <img src="{{staticMap}}"/>

        </div>
    </div>

    <div class="modal fade modal-apply" id="apply" tabindex="-1" role="dialog" aria-labelledby="applyLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true" ng-click="clearRequirement()">&times;</button>
                    <h2 class="modal-title" id="applyLabel" translate="resource.offer.title">Choose resource offer</h2>
                </div>
                <div class="modal-body">
                    <form name="applyForm" role="form" novalidate show-validation class="ng-scope ng-invalid ng-invalid-required ng-dirty ng-valid-minlength">
                        <dl class="dl-horizontal">
                            <dt translate="resource.offer.resourceselected"></dt>
                            <dd>{{ ProjectApply.selectedRequirement.name }}</dd>
                            <dt translate="resource.offer.resourceneeded"></dt>
                            <dd>{{ ProjectApply.selectedRequirement.amount }}</dd>
                        </dl>
                        <ul class="resources">
                            <li ng-click="selectResourceOffer(offer, $event)" class="resource row" ng-repeat="offer in resourceOffers">
                                <div class="col-md-2">
                                    <img src="" alt="">
                                </div>
                                <div class="pull-right col-md-6 offerdesc">
                                    {{ offer.description }}
                                </div>
                                <h2 class="col-md-4">
                                    {{ offer.name }}
                                    <span ng-hide="offer.amount == 1">({{ offer.amount }})</span>
                                </h2>
                            </li>
                        </ul>
                    </form>
                </div>
                <div class="modal-footer">
                    <button id="resourceCancelButton" type="button" class="btn btn-link" data-dismiss="modal">
                        {{ 'resource.new.cancelbutton' | translate }}
                    </button>
                    <button id="resourceSaveButton" type="button" ng-click="projectApplySubmit($event)" data-dismiss="modal" class="btn btn-success" ng-disabled="applyForm.$invalid">
                        <span class="glyphicon glyphicon-save"></span> {{ 'resource.new.savebutton' | translate }}
                    </button>
                </div>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="rateMatchModal" tabindex="-1" role="dialog" aria-labelledby="rateMatchModalLabel"
     aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form name="sendform" role="form" novalidate show-validation
                  class="ng-scope ng-invalid ng-invalid-required ng-dirty ng-valid-minlength"
                  ng-submit="rateOrganization()">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true"
                            ng-click="clearRating()">&times;</button>
                    <h4 class="modal-title" id="myTextMessageLabel"
                        translate="rating.match.dorate">Rate the interaction!</h4>
                </div>
                <div class="modal-body">

                    <div class="form-group">
                        <label translate="rating.yourrating">Receiver</label>
                        <rating max="5" on-leave="overStar = null"
                                readonly="false"
                                ng-click="dummy = 5"
                                ng-model="currentOrgRating"></rating>

                    </div>
                    <div class="form-group">
                        <label translate="rating.yourcomment">Comment</label>
                            <textarea name="comment" class="fullwidth form-control"
                                      ng-model="currentOrgRatingComment" placeholder="{{'rating.placeholder' | translate}}"
                                      ng-maxlength="2048"></textarea>
                    </div>
                    <div id="orgRatingError" class="alert alert-danger" ng-show="orgRatingError"
                         translate="rating.error.general">
                        <strong>An error has occured!</strong>
                        Sorry, something went wrong.
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal" ng-click="clearRating()">
                        <span class="glyphicon glyphicon-ban-circle"></span>
                        <span translate="rating.notnow">Not now</span>
                    </button>
                    <button type="submit" ng-disabled="sendform.$invalid" class="btn btn-primary">
                        <span class="glyphicon glyphicon-save"></span>
                        <span translate="rating.ratenow">Rate now</span>
                    </button>
                </div>
            </form>


        </div>
    </div>
</div>
